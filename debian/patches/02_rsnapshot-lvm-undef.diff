Author: Michel DÃ¤nzer <michel@daenzer.net
Description: Non-LVM backup source breaks after LVM backup source
Last-Update: 2015-07-31
Bug-Debian: https://bugs.debian.org/794046
Forwarded: https://github.com/rsnapshot/rsnapshot/pull/111

Index: rsnapshot/rsnapshot-program.pl
===================================================================
--- rsnapshot.orig/rsnapshot-program.pl
+++ rsnapshot/rsnapshot-program.pl
@@ -3950,13 +3950,13 @@ sub rsync_backup_point {
 	# delte the traps manually
 	# umount LVM Snapshot if it is mounted
 	if (1 == $traps{"linux_lvm_mountpoint"}) {
-		undef $traps{"linux_lvm_mountpoint"};
+		$traps{"linux_lvm_mountpoint"} = 0;
 		linux_lvm_unmount();
 	}
 
 	# destroy snapshot created by rsnapshot
 	if (0 ne $traps{"linux_lvm_snapshot"}) {
-		undef $traps{"linux_lvm_snapshot"};
+		$traps{"linux_lvm_snapshot"} = 0;
 		linux_lvm_snapshot_del(linux_lvm_parseurl($lvm_src));
 	}
 }
